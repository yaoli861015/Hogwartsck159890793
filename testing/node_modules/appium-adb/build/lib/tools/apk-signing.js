"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _fs2 = _interopRequireDefault(require("fs"));

var _teen_process = require("teen_process");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("../logger.js"));

var _appiumSupport = require("appium-support");

var _helpers = require("../helpers.js");

const DEFAULT_PRIVATE_KEY = _path.default.resolve(_helpers.rootDir, 'keys', 'testkey.pk8');

const DEFAULT_CERTIFICATE = _path.default.resolve(_helpers.rootDir, 'keys', 'testkey.x509.pem');

const BUNDLETOOL_TUTORIAL = 'https://developer.android.com/studio/command-line/bundletool';
const APKSIGNER_VERIFY_FAIL = 'DOES NOT VERIFY';
const SHA1 = 'sha1';
const SHA256 = 'sha256';
const SHA512 = 'sha512';
const MD5 = 'md5';
const DEFAULT_CERT_HASH = {
  [SHA256]: 'a40da80a59d170caa950cf15c18c454d47a39b26989d8b640ecd745ba71bf5dc'
};
const apkSigningMethods = {};

apkSigningMethods.executeApksigner = async function executeApksigner(args = []) {
  const apkSignerJar = await (0, _helpers.getApksignerForOs)(this);
  const fullCmd = [await (0, _helpers.getJavaForOs)(), '-Xmx1024M', '-Xss1m', '-jar', apkSignerJar, ...args];

  _logger.default.debug(`Starting apksigner: ${_appiumSupport.util.quote(fullCmd)}`);

  const {
    stdout,
    stderr
  } = await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1));

  for (let [name, stream] of [['stdout', stdout], ['stderr', stderr]]) {
    if (!_lodash.default.trim(stream)) {
      continue;
    }

    if (name === 'stdout') {
      stream = stream.split('\n').filter(line => !line.includes('WARNING:')).join('\n');
    }

    _logger.default.debug(`apksigner ${name}: ${stream}`);
  }

  return stdout;
};

apkSigningMethods.signWithDefaultCert = async function signWithDefaultCert(apk) {
  _logger.default.debug(`Signing '${apk}' with default cert`);

  if (!(await _appiumSupport.fs.exists(apk))) {
    throw new Error(`${apk} file doesn't exist.`);
  }

  const args = ['sign', '--key', DEFAULT_PRIVATE_KEY, '--cert', DEFAULT_CERTIFICATE, apk];

  try {
    await this.executeApksigner(args);
  } catch (e) {
    throw new Error(`Could not sign '${apk}' with the default certificate. ` + `Original error: ${e.stderr || e.stdout || e.message}`);
  }
};

apkSigningMethods.signWithCustomCert = async function signWithCustomCert(apk) {
  _logger.default.debug(`Signing '${apk}' with custom cert`);

  if (!(await _appiumSupport.fs.exists(this.keystorePath))) {
    throw new Error(`Keystore: ${this.keystorePath} doesn't exist.`);
  }

  if (!(await _appiumSupport.fs.exists(apk))) {
    throw new Error(`'${apk}' doesn't exist.`);
  }

  try {
    await this.executeApksigner(['sign', '--ks', this.keystorePath, '--ks-key-alias', this.keyAlias, '--ks-pass', `pass:${this.keystorePassword}`, '--key-pass', `pass:${this.keyPassword}`, apk]);
  } catch (err) {
    _logger.default.warn(`Cannot use apksigner tool for signing. Defaulting to jarsigner. ` + `Original error: ${err.stderr || err.stdout || err.message}`);

    try {
      if (await (0, _helpers.unsignApk)(apk)) {
        _logger.default.debug(`'${apk}' has been successfully unsigned`);
      } else {
        _logger.default.debug(`'${apk}' does not need to be unsigned`);
      }

      const jarsigner = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `jarsigner${_appiumSupport.system.isWindows() ? '.exe' : ''}`);

      const fullCmd = [jarsigner, '-sigalg', 'MD5withRSA', '-digestalg', 'SHA1', '-keystore', this.keystorePath, '-storepass', this.keystorePassword, '-keypass', this.keyPassword, apk, this.keyAlias];

      _logger.default.debug(`Starting jarsigner: ${_appiumSupport.util.quote(fullCmd)}`);

      await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1));
    } catch (e) {
      throw new Error(`Could not sign with custom certificate. ` + `Original error: ${e.stderr || e.message}`);
    }
  }
};

apkSigningMethods.sign = async function sign(appPath) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    let message = 'Signing of .apks-files is not supported. ';

    if (this.useKeystore) {
      message += 'Consider manual application bundle signing with the custom keystore ' + `like it is described at ${BUNDLETOOL_TUTORIAL}`;
    } else {
      message += `Consider manual application bundle signing with the key at '${DEFAULT_PRIVATE_KEY}' ` + `and the certificate at '${DEFAULT_CERTIFICATE}'. Read ${BUNDLETOOL_TUTORIAL} for more details.`;
    }

    _logger.default.warn(message);

    return;
  }

  await this.zipAlignApk(appPath);

  if (this.useKeystore) {
    await this.signWithCustomCert(appPath);
  } else {
    await this.signWithDefaultCert(appPath);
  }
};

apkSigningMethods.zipAlignApk = async function zipAlignApk(apk) {
  await this.initZipAlign();

  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-c', '4', apk]);

    _logger.default.debug(`${apk}' is already zip-aligned. Doing nothing`);

    return false;
  } catch (e) {
    _logger.default.debug(`'${apk}' is not zip-aligned. Aligning`);
  }

  try {
    await _appiumSupport.fs.access(apk, _fs2.default.W_OK);
  } catch (e) {
    throw new Error(`The file at '${apk}' is not writeable. ` + `Please grant write permissions to this file or to its parent folder '${_path.default.dirname(apk)}' ` + `for the Appium process, so it can zip-align the file`);
  }

  const alignedApk = await _appiumSupport.tempDir.path({
    prefix: 'appium',
    suffix: '.tmp'
  });
  await (0, _appiumSupport.mkdirp)(_path.default.dirname(alignedApk));

  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-f', '4', apk, alignedApk]);
    await _appiumSupport.fs.mv(alignedApk, apk, {
      mkdirp: true
    });
    return true;
  } catch (e) {
    if (await _appiumSupport.fs.exists(alignedApk)) {
      await _appiumSupport.fs.unlink(alignedApk);
    }

    throw new Error(`zipAlignApk failed. Original error: ${e.stderr || e.message}`);
  }
};

apkSigningMethods.checkApkCert = async function checkApkCert(appPath, pkg, opts = {}) {
  _logger.default.debug(`Checking app cert for ${appPath}`);

  if (!(await _appiumSupport.fs.exists(appPath))) {
    _logger.default.debug(`'${appPath}' does not exist`);

    return false;
  }

  if (_path.default.extname(appPath) === _helpers.APKS_EXTENSION) {
    appPath = await this.extractBaseApk(appPath);
  }

  const expectedHash = this.useKeystore ? await this.getKeystoreHash(appPath, pkg) : DEFAULT_CERT_HASH;

  const hashMatches = apksignerOutput => {
    for (const [name, value] of _lodash.default.toPairs(expectedHash)) {
      if (new RegExp(`digest:\\s+${value}\\b`, 'i').test(apksignerOutput)) {
        _logger.default.debug(`${name} hash did match for '${_path.default.basename(appPath)}'`);

        return true;
      }
    }

    return false;
  };

  const {
    requireDefaultCert = true
  } = opts;

  try {
    await (0, _helpers.getApksignerForOs)(this);
    const output = await this.executeApksigner(['verify', '--print-certs', appPath]);
    const hasMatch = hashMatches(output);

    if (hasMatch) {
      _logger.default.info(`'${appPath}' is signed with the ` + `${this.useKeystore ? 'keystore' : 'default'} certificate`);
    } else {
      _logger.default.info(`'${appPath}' is signed with a ` + `non-${this.useKeystore ? 'keystore' : 'default'} certificate`);
    }

    return !this.useKeystore && !requireDefaultCert || hasMatch;
  } catch (err) {
    if (_lodash.default.includes(err.stderr, APKSIGNER_VERIFY_FAIL)) {
      _logger.default.info(`'${appPath}' is not signed`);

      return false;
    }

    throw new Error(`Cannot verify the signature of '${appPath}'. ` + `Original error: ${err.stderr || err.stdout || err.message}`);
  }
};

apkSigningMethods.getKeystoreHash = async function getKeystoreHash() {
  _logger.default.debug(`Getting hash of the '${this.keystorePath}' keystore`);

  const keytool = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `keytool${_appiumSupport.system.isWindows() ? '.exe' : ''}`);

  if (!(await _appiumSupport.fs.exists(keytool))) {
    throw new Error(`The keytool utility cannot be found at '${keytool}'`);
  }

  const args = ['-v', '-list', '-alias', this.keyAlias, '-keystore', this.keystorePath, '-storepass', this.keystorePassword];

  _logger.default.info(`Running '${keytool}' with arguments: ${_appiumSupport.util.quote(args)}`);

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(keytool, args);
    const result = {};

    for (const hashName of [SHA512, SHA256, SHA1, MD5]) {
      const hashRe = new RegExp(`^\\s*${hashName}:\\s*([a-f0-9:]+)`, 'mi');
      const match = hashRe.exec(stdout);

      if (!match) {
        continue;
      }

      result[hashName] = match[1].replace(/:/g, '').toLowerCase();
    }

    if (_lodash.default.isEmpty(result)) {
      _logger.default.debug(stdout);

      throw new Error('Cannot parse the hash value from the keytool output');
    }

    _logger.default.debug(`Keystore hash: ${JSON.stringify(result)}`);

    return result;
  } catch (e) {
    throw new Error(`Cannot get the hash of '${this.keystorePath}' keystore. ` + `Original error: ${e.stderr || e.message}`);
  }
};

var _default = apkSigningMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hcGstc2lnbmluZy5qcyJdLCJuYW1lcyI6WyJERUZBVUxUX1BSSVZBVEVfS0VZIiwicGF0aCIsInJlc29sdmUiLCJyb290RGlyIiwiREVGQVVMVF9DRVJUSUZJQ0FURSIsIkJVTkRMRVRPT0xfVFVUT1JJQUwiLCJBUEtTSUdORVJfVkVSSUZZX0ZBSUwiLCJTSEExIiwiU0hBMjU2IiwiU0hBNTEyIiwiTUQ1IiwiREVGQVVMVF9DRVJUX0hBU0giLCJhcGtTaWduaW5nTWV0aG9kcyIsImV4ZWN1dGVBcGtzaWduZXIiLCJhcmdzIiwiYXBrU2lnbmVySmFyIiwiZnVsbENtZCIsImxvZyIsImRlYnVnIiwidXRpbCIsInF1b3RlIiwic3Rkb3V0Iiwic3RkZXJyIiwic2xpY2UiLCJuYW1lIiwic3RyZWFtIiwiXyIsInRyaW0iLCJzcGxpdCIsImZpbHRlciIsImxpbmUiLCJpbmNsdWRlcyIsImpvaW4iLCJzaWduV2l0aERlZmF1bHRDZXJ0IiwiYXBrIiwiZnMiLCJleGlzdHMiLCJFcnJvciIsImUiLCJtZXNzYWdlIiwic2lnbldpdGhDdXN0b21DZXJ0Iiwia2V5c3RvcmVQYXRoIiwia2V5QWxpYXMiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5UGFzc3dvcmQiLCJlcnIiLCJ3YXJuIiwiamFyc2lnbmVyIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwic2lnbiIsImFwcFBhdGgiLCJlbmRzV2l0aCIsIkFQS1NfRVhURU5TSU9OIiwidXNlS2V5c3RvcmUiLCJ6aXBBbGlnbkFwayIsImluaXRaaXBBbGlnbiIsImJpbmFyaWVzIiwiemlwYWxpZ24iLCJhY2Nlc3MiLCJfZnMiLCJXX09LIiwiZGlybmFtZSIsImFsaWduZWRBcGsiLCJ0ZW1wRGlyIiwicHJlZml4Iiwic3VmZml4IiwibXYiLCJta2RpcnAiLCJ1bmxpbmsiLCJjaGVja0Fwa0NlcnQiLCJwa2ciLCJvcHRzIiwiZXh0bmFtZSIsImV4dHJhY3RCYXNlQXBrIiwiZXhwZWN0ZWRIYXNoIiwiZ2V0S2V5c3RvcmVIYXNoIiwiaGFzaE1hdGNoZXMiLCJhcGtzaWduZXJPdXRwdXQiLCJ2YWx1ZSIsInRvUGFpcnMiLCJSZWdFeHAiLCJ0ZXN0IiwiYmFzZW5hbWUiLCJyZXF1aXJlRGVmYXVsdENlcnQiLCJvdXRwdXQiLCJoYXNNYXRjaCIsImluZm8iLCJrZXl0b29sIiwicmVzdWx0IiwiaGFzaE5hbWUiLCJoYXNoUmUiLCJtYXRjaCIsImV4ZWMiLCJyZXBsYWNlIiwidG9Mb3dlckNhc2UiLCJpc0VtcHR5IiwiSlNPTiIsInN0cmluZ2lmeSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFLQSxNQUFNQSxtQkFBbUIsR0FBR0MsY0FBS0MsT0FBTCxDQUFhQyxnQkFBYixFQUFzQixNQUF0QixFQUE4QixhQUE5QixDQUE1Qjs7QUFDQSxNQUFNQyxtQkFBbUIsR0FBR0gsY0FBS0MsT0FBTCxDQUFhQyxnQkFBYixFQUFzQixNQUF0QixFQUE4QixrQkFBOUIsQ0FBNUI7O0FBQ0EsTUFBTUUsbUJBQW1CLEdBQUcsOERBQTVCO0FBQ0EsTUFBTUMscUJBQXFCLEdBQUcsaUJBQTlCO0FBQ0EsTUFBTUMsSUFBSSxHQUFHLE1BQWI7QUFDQSxNQUFNQyxNQUFNLEdBQUcsUUFBZjtBQUNBLE1BQU1DLE1BQU0sR0FBRyxRQUFmO0FBQ0EsTUFBTUMsR0FBRyxHQUFHLEtBQVo7QUFDQSxNQUFNQyxpQkFBaUIsR0FBRztBQUN4QixHQUFDSCxNQUFELEdBQVU7QUFEYyxDQUExQjtBQUtBLE1BQU1JLGlCQUFpQixHQUFHLEVBQTFCOztBQVVBQSxpQkFBaUIsQ0FBQ0MsZ0JBQWxCLEdBQXFDLGVBQWVBLGdCQUFmLENBQWlDQyxJQUFJLEdBQUcsRUFBeEMsRUFBNEM7QUFDL0UsUUFBTUMsWUFBWSxHQUFHLE1BQU0sZ0NBQWtCLElBQWxCLENBQTNCO0FBQ0EsUUFBTUMsT0FBTyxHQUFHLENBQ2QsTUFBTSw0QkFEUSxFQUNRLFdBRFIsRUFDcUIsUUFEckIsRUFFZCxNQUZj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QUFWLENBQUosRUFBdUI7QUFDckJ4RSxzQkFBSUMsS0FBSixDQUFVRyxNQUFWOztBQUNBLFlBQU0sSUFBSWdCLEtBQUosQ0FBVSxxREFBVixDQUFOO0FBQ0Q7O0FBQ0RwQixvQkFBSUMsS0FBSixDQUFXLGtCQUFpQitFLElBQUksQ0FBQ0MsU0FBTCxDQUFlVCxNQUFmLENBQXVCLEVBQW5EOztBQUNBLFdBQU9BLE1BQVA7QUFDRCxHQWpCRCxDQWlCRSxPQUFPbkQsQ0FBUCxFQUFVO0FBQ1YsVUFBTSxJQUFJRCxLQUFKLENBQVcsMkJBQTBCLEtBQUtJLFlBQWEsY0FBN0MsR0FDYixtQkFBa0JILENBQUMsQ0FBQ2hCLE1BQUYsSUFBWWdCLENBQUMsQ0FBQ0MsT0FBUSxFQURyQyxDQUFOO0FBRUQ7QUFDRixDQW5DRDs7ZUFxQ2UzQixpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgX2ZzIGZyb20gJ2ZzJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQgeyB0ZW1wRGlyLCBzeXN0ZW0sIG1rZGlycCwgZnMsIHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQge1xuICBnZXRKYXZhRm9yT3MsIGdldEFwa3NpZ25lckZvck9zLCBnZXRKYXZhSG9tZSxcbiAgcm9vdERpciwgQVBLU19FWFRFTlNJT04sIHVuc2lnbkFwayxcbn0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5cbmNvbnN0IERFRkFVTFRfUFJJVkFURV9LRVkgPSBwYXRoLnJlc29sdmUocm9vdERpciwgJ2tleXMnLCAndGVzdGtleS5wazgnKTtcbmNvbnN0IERFRkFVTFRfQ0VSVElGSUNBVEUgPSBwYXRoLnJlc29sdmUocm9vdERpciwgJ2tleXMnLCAndGVzdGtleS54NTA5LnBlbScpO1xuY29uc3QgQlVORExFVE9PTF9UVVRPUklBTCA9ICdodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9zdHVkaW8vY29tbWFuZC1saW5lL2J1bmRsZXRvb2wnO1xuY29uc3QgQVBLU0lHTkVSX1ZFUklGWV9GQUlMID0gJ0RPRVMgTk9UIFZFUklGWSc7XG5jb25zdCBTSEExID0gJ3NoYTEnO1xuY29uc3QgU0hBMjU2ID0gJ3NoYTI1Nic7XG5jb25zdCBTSEE1MTIgPSAnc2hhNTEyJztcbmNvbnN0IE1ENSA9ICdtZDUnO1xuY29uc3QgREVGQVVMVF9DRVJUX0hBU0ggPSB7XG4gIFtTSEEyNTZdOiAnYTQwZGE4MGE1OWQxNzBjYWE5NTBjZjE1YzE4YzQ1NGQ0N2EzOWIyNjk4OWQ4YjY0MGVjZDc0NWJhNzFiZjVkYydcbn07XG5cblxuY29uc3QgYXBrU2lnbmluZ01ldGhvZHMgPSB7fTtcblxuLyoqXG4gKiBFeGVjdXRlIGFwa3NpZ25lciB1dGlsaXR5IHdpdGggZ2l2ZW4gYXJndW1lbnRzLlxuICpcbiAqIEBwYXJhbSB7P0FycmF5PFN0cmluZz59IGFyZ3MgLSBUaGUgbGlzdCBvZiB0b29sIGFyZ3VtZW50cy5cbiAqIEByZXR1cm4ge3N0cmluZ30gLSBDb21tYW5kIHN0ZG91dFxuICogQHRocm93cyB7RXJyb3J9IElmIGFwa3NpZ25lciBiaW5hcnkgaXMgbm90IHByZXNlbnQgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtXG4gKiAgICAgICAgICAgICAgICAgb3IgdGhlIHJldHVybiBjb2RlIGlzIG5vdCBlcXVhbCB0byB6ZXJvLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5leGVjdXRlQXBrc2lnbmVyID0gYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUFwa3NpZ25lciAoYXJncyA9IFtdKSB7XG4gIGNvbnN0IGFwa1NpZ25lckphciA9IGF3YWl0IGdldEFwa3NpZ25lckZvck9zKHRoaXMpO1xuICBjb25zdCBmdWxsQ21kID0gW1xuICAgIGF3YWl0IGdldEphdmFGb3JPcygpLCAnLVhteDEwMjRNJywgJy1Yc3MxbScsXG4gICAgJy1qYXInLCBhcGtTaWduZXJKYXIsXG4gICAgLi4uYXJnc1xuICBdO1xuICBsb2cuZGVidWcoYFN0YXJ0aW5nIGFwa3NpZ25lcjogJHt1dGlsLnF1b3RlKGZ1bGxDbWQpfWApO1xuICBjb25zdCB7c3Rkb3V0LCBzdGRlcnJ9ID0gYXdhaXQgZXhlYyhmdWxsQ21kWzBdLCBmdWxsQ21kLnNsaWNlKDEpKTtcbiAgZm9yIChsZXQgW25hbWUsIHN0cmVhbV0gb2YgW1snc3Rkb3V0Jywgc3Rkb3V0XSwgWydzdGRlcnInLCBzdGRlcnJdXSkge1xuICAgIGlmICghXy50cmltKHN0cmVhbSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChuYW1lID09PSAnc3Rkb3V0Jykge1xuICAgICAgLy8gTWFrZSB0aGUgb3V0cHV0IGxlc3MgdGFsa2F0aXZlXG4gICAgICBzdHJlYW0gPSBzdHJlYW0uc3BsaXQoJ1xcbicpXG4gICAgICAgIC5maWx0ZXIoKGxpbmUpID0+ICFsaW5lLmluY2x1ZGVzKCdXQVJOSU5HOicpKVxuICAgICAgICAuam9pbignXFxuJyk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgYXBrc2lnbmVyICR7bmFtZX06ICR7c3RyZWFtfWApO1xuICB9XG4gIHJldHVybiBzdGRvdXQ7XG59O1xuXG4vKipcbiAqIChSZSlzaWduIHRoZSBnaXZlbiBhcGsgZmlsZSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gd2l0aCB0aGUgZGVmYXVsdCBjZXJ0aWZpY2F0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgYXBrIGZpbGUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgc2lnbmluZyBmYWlscy5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuc2lnbldpdGhEZWZhdWx0Q2VydCA9IGFzeW5jIGZ1bmN0aW9uIHNpZ25XaXRoRGVmYXVsdENlcnQgKGFwaykge1xuICBsb2cuZGVidWcoYFNpZ25pbmcgJyR7YXBrfScgd2l0aCBkZWZhdWx0IGNlcnRgKTtcbiAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKGFwaykpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke2Fwa30gZmlsZSBkb2Vzbid0IGV4aXN0LmApO1xuICB9XG5cbiAgY29uc3QgYXJncyA9IFtcbiAgICAnc2lnbicsXG4gICAgJy0ta2V5JywgREVGQVVMVF9QUklWQVRFX0tFWSxcbiAgICAnLS1jZXJ0JywgREVGQVVMVF9DRVJUSUZJQ0FURSxcbiAgICBhcGssXG4gIF07XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXBrc2lnbmVyKGFyZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3Qgc2lnbiAnJHthcGt9JyB3aXRoIHRoZSBkZWZhdWx0IGNlcnRpZmljYXRlLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLnN0ZG91dCB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogKFJlKXNpZ24gdGhlIGdpdmVuIGFwayBmaWxlIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSB3aXRoIGEgY3VzdG9tIGNlcnRpZmljYXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGsgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCBhcGsgZmlsZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBzaWduaW5nIGZhaWxzLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5zaWduV2l0aEN1c3RvbUNlcnQgPSBhc3luYyBmdW5jdGlvbiBzaWduV2l0aEN1c3RvbUNlcnQgKGFwaykge1xuICBsb2cuZGVidWcoYFNpZ25pbmcgJyR7YXBrfScgd2l0aCBjdXN0b20gY2VydGApO1xuICBpZiAoIShhd2FpdCBmcy5leGlzdHModGhpcy5rZXlzdG9yZVBhdGgpKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgS2V5c3RvcmU6ICR7dGhpcy5rZXlzdG9yZVBhdGh9IGRvZXNuJ3QgZXhpc3QuYCk7XG4gIH1cbiAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKGFwaykpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAnJHthcGt9JyBkb2Vzbid0IGV4aXN0LmApO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBcGtzaWduZXIoWydzaWduJyxcbiAgICAgICctLWtzJywgdGhpcy5rZXlzdG9yZVBhdGgsXG4gICAgICAnLS1rcy1rZXktYWxpYXMnLCB0aGlzLmtleUFsaWFzLFxuICAgICAgJy0ta3MtcGFzcycsIGBwYXNzOiR7dGhpcy5rZXlzdG9yZVBhc3N3b3JkfWAsXG4gICAgICAnLS1rZXktcGFzcycsIGBwYXNzOiR7dGhpcy5rZXlQYXNzd29yZH1gLFxuICAgICAgYXBrXSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgdXNlIGFwa3NpZ25lciB0b29sIGZvciBzaWduaW5nLiBEZWZhdWx0aW5nIHRvIGphcnNpZ25lci4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLnN0ZGVyciB8fCBlcnIuc3Rkb3V0IHx8IGVyci5tZXNzYWdlfWApO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXdhaXQgdW5zaWduQXBrKGFwaykpIHtcbiAgICAgICAgbG9nLmRlYnVnKGAnJHthcGt9JyBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgdW5zaWduZWRgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgJyR7YXBrfScgZG9lcyBub3QgbmVlZCB0byBiZSB1bnNpZ25lZGApO1xuICAgICAgfVxuICAgICAgY29uc3QgamFyc2lnbmVyID0gcGF0aC5yZXNvbHZlKGF3YWl0IGdldEphdmFIb21lKCksICdiaW4nLFxuICAgICAgICBgamFyc2lnbmVyJHtzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnLmV4ZScgOiAnJ31gKTtcbiAgICAgIGNvbnN0IGZ1bGxDbWQgPSBbamFyc2lnbmVyLFxuICAgICAgICAnLXNpZ2FsZycsICdNRDV3aXRoUlNBJyxcbiAgICAgICAgJy1kaWdlc3RhbGcnLCAnU0hBMScsXG4gICAgICAgICcta2V5c3RvcmUnLCB0aGlzLmtleXN0b3JlUGF0aCxcbiAgICAgICAgJy1zdG9yZXBhc3MnLCB0aGlzLmtleXN0b3JlUGFzc3dvcmQsXG4gICAgICAgICcta2V5cGFzcycsIHRoaXMua2V5UGFzc3dvcmQsXG4gICAgICAgIGFwaywgdGhpcy5rZXlBbGlhc107XG4gICAgICBsb2cuZGVidWcoYFN0YXJ0aW5nIGphcnNpZ25lcjogJHt1dGlsLnF1b3RlKGZ1bGxDbWQpfWApO1xuICAgICAgYXdhaXQgZXhlYyhmdWxsQ21kWzBdLCBmdWxsQ21kLnNsaWNlKDEpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBzaWduIHdpdGggY3VzdG9tIGNlcnRpZmljYXRlLiBgICtcbiAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogKFJlKXNpZ24gdGhlIGdpdmVuIGFwayBmaWxlIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSB3aXRoIGVpdGhlclxuICogY3VzdG9tIG9yIGRlZmF1bHQgY2VydGlmaWNhdGUgYmFzZWQgb24gX3RoaXMudXNlS2V5c3RvcmVfIHByb3BlcnR5IHZhbHVlXG4gKiBhbmQgWmlwLWFsaWducyBpdCBhZnRlciBzaWduaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgLmFwayhzKSBmaWxlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHNpZ25pbmcgZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLnNpZ24gPSBhc3luYyBmdW5jdGlvbiBzaWduIChhcHBQYXRoKSB7XG4gIGlmIChhcHBQYXRoLmVuZHNXaXRoKEFQS1NfRVhURU5TSU9OKSkge1xuICAgIGxldCBtZXNzYWdlID0gJ1NpZ25pbmcgb2YgLmFwa3MtZmlsZXMgaXMgbm90IHN1cHBvcnRlZC4gJztcbiAgICBpZiAodGhpcy51c2VLZXlzdG9yZSkge1xuICAgICAgbWVzc2FnZSArPSAnQ29uc2lkZXIgbWFudWFsIGFwcGxpY2F0aW9uIGJ1bmRsZSBzaWduaW5nIHdpdGggdGhlIGN1c3RvbSBrZXlzdG9yZSAnICtcbiAgICAgICAgYGxpa2UgaXQgaXMgZGVzY3JpYmVkIGF0ICR7QlVORExFVE9PTF9UVVRPUklBTH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZXNzYWdlICs9IGBDb25zaWRlciBtYW51YWwgYXBwbGljYXRpb24gYnVuZGxlIHNpZ25pbmcgd2l0aCB0aGUga2V5IGF0ICcke0RFRkFVTFRfUFJJVkFURV9LRVl9JyBgICtcbiAgICAgICAgYGFuZCB0aGUgY2VydGlmaWNhdGUgYXQgJyR7REVGQVVMVF9DRVJUSUZJQ0FURX0nLiBSZWFkICR7QlVORExFVE9PTF9UVVRPUklBTH0gZm9yIG1vcmUgZGV0YWlscy5gO1xuICAgIH1cbiAgICBsb2cud2FybihtZXNzYWdlKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpdCBpcyBuZWNlc3NhcnkgdG8gYXBwbHkgemlwYWxpZ24gb25seSBiZWZvcmUgc2lnbmluZ1xuICAvLyBpZiBhcGtzaWduZXIgaXMgdXNlZFxuICBhd2FpdCB0aGlzLnppcEFsaWduQXBrKGFwcFBhdGgpO1xuXG4gIGlmICh0aGlzLnVzZUtleXN0b3JlKSB7XG4gICAgYXdhaXQgdGhpcy5zaWduV2l0aEN1c3RvbUNlcnQoYXBwUGF0aCk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgdGhpcy5zaWduV2l0aERlZmF1bHRDZXJ0KGFwcFBhdGgpO1xuICB9XG59O1xuXG4vKipcbiAqIFBlcmZvcm0gemlwLWFsaWduaW5nIHRvIHRoZSBnaXZlbiBsb2NhbCBhcGsgZmlsZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgYXBrIGZpbGUuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgYXBrIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBhbGlnbmVkXG4gKiBvciBmYWxzZSBpZiB0aGUgYXBrIGhhcyBiZWVuIGFscmVhZHkgYWxpZ25lZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB6aXAtYWxpZ24gZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLnppcEFsaWduQXBrID0gYXN5bmMgZnVuY3Rpb24gemlwQWxpZ25BcGsgKGFwaykge1xuICBhd2FpdCB0aGlzLmluaXRaaXBBbGlnbigpO1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy56aXBhbGlnbiwgWyctYycsICc0JywgYXBrXSk7XG4gICAgbG9nLmRlYnVnKGAke2Fwa30nIGlzIGFscmVhZHkgemlwLWFsaWduZWQuIERvaW5nIG5vdGhpbmdgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoYCcke2Fwa30nIGlzIG5vdCB6aXAtYWxpZ25lZC4gQWxpZ25pbmdgKTtcbiAgfVxuICB0cnkge1xuICAgIGF3YWl0IGZzLmFjY2VzcyhhcGssIF9mcy5XX09LKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgYXQgJyR7YXBrfScgaXMgbm90IHdyaXRlYWJsZS4gYCArXG4gICAgICBgUGxlYXNlIGdyYW50IHdyaXRlIHBlcm1pc3Npb25zIHRvIHRoaXMgZmlsZSBvciB0byBpdHMgcGFyZW50IGZvbGRlciAnJHtwYXRoLmRpcm5hbWUoYXBrKX0nIGAgK1xuICAgICAgYGZvciB0aGUgQXBwaXVtIHByb2Nlc3MsIHNvIGl0IGNhbiB6aXAtYWxpZ24gdGhlIGZpbGVgKTtcbiAgfVxuICBjb25zdCBhbGlnbmVkQXBrID0gYXdhaXQgdGVtcERpci5wYXRoKHtwcmVmaXg6ICdhcHBpdW0nLCBzdWZmaXg6ICcudG1wJ30pO1xuICBhd2FpdCBta2RpcnAocGF0aC5kaXJuYW1lKGFsaWduZWRBcGspKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuemlwYWxpZ24sIFsnLWYnLCAnNCcsIGFwaywgYWxpZ25lZEFwa10pO1xuICAgIGF3YWl0IGZzLm12KGFsaWduZWRBcGssIGFwaywgeyBta2RpcnA6IHRydWUgfSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGFsaWduZWRBcGspKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsoYWxpZ25lZEFwayk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgemlwQWxpZ25BcGsgZmFpbGVkLiBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ2VydENoZWNrT3B0aW9uc1xuICogQHByb3BlcnR5IHtib29sZWFufSByZXF1aXJlRGVmYXVsdENlcnQgW3RydWVdIFdoZXRoZXIgdG8gcmVxdWlyZSB0aGF0IHRoZSBkZXN0aW5hdGlvbiBBUEtcbiAqIGlzIHNpZ25lZCB3aXRoIHRoZSBkZWZhdWx0IEFwcGl1bSBjZXJ0aWZpY2F0ZSBvciBhbnkgdmFsaWQgY2VydGlmaWNhdGUuIFRoaXMgb3B0aW9uXG4gKiBvbmx5IGhhcyBlZmZlY3QgaWYgYHVzZUtleXN0b3JlYCBwcm9wZXJ0eSBpcyB1bnNldC5cbiAqL1xuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBhcHAgaXMgYWxyZWFkeSBzaWduZWQgd2l0aCB0aGUgZGVmYXVsdCBBcHBpdW0gY2VydGlmaWNhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCAuYXBrKHMpIGZpbGUuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGdrIC0gVGhlIG5hbWUgb2YgYXBwbGljYXRpb24gcGFja2FnZS5cbiAqIEBwYXJhbSB7Q2VydENoZWNrT3B0aW9uc30gb3B0cyAtIENlcnRpZmljYXRlIGNoZWNraW5nIG9wdGlvbnNcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgZ2l2ZW4gYXBwbGljYXRpb24gaXMgYWxyZWFkeSBzaWduZWQuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLmNoZWNrQXBrQ2VydCA9IGFzeW5jIGZ1bmN0aW9uIGNoZWNrQXBrQ2VydCAoYXBwUGF0aCwgcGtnLCBvcHRzID0ge30pIHtcbiAgbG9nLmRlYnVnKGBDaGVja2luZyBhcHAgY2VydCBmb3IgJHthcHBQYXRofWApO1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBQYXRoKSkge1xuICAgIGxvZy5kZWJ1ZyhgJyR7YXBwUGF0aH0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHBhdGguZXh0bmFtZShhcHBQYXRoKSA9PT0gQVBLU19FWFRFTlNJT04pIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIGNvbnN0IGV4cGVjdGVkSGFzaCA9IHRoaXMudXNlS2V5c3RvcmVcbiAgICA/IGF3YWl0IHRoaXMuZ2V0S2V5c3RvcmVIYXNoKGFwcFBhdGgsIHBrZylcbiAgICA6IERFRkFVTFRfQ0VSVF9IQVNIO1xuXG4gIGNvbnN0IGhhc2hNYXRjaGVzID0gKGFwa3NpZ25lck91dHB1dCkgPT4ge1xuICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBfLnRvUGFpcnMoZXhwZWN0ZWRIYXNoKSkge1xuICAgICAgaWYgKG5ldyBSZWdFeHAoYGRpZ2VzdDpcXFxccyske3ZhbHVlfVxcXFxiYCwgJ2knKS50ZXN0KGFwa3NpZ25lck91dHB1dCkpIHtcbiAgICAgICAgbG9nLmRlYnVnKGAke25hbWV9IGhhc2ggZGlkIG1hdGNoIGZvciAnJHtwYXRoLmJhc2VuYW1lKGFwcFBhdGgpfSdgKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCB7XG4gICAgcmVxdWlyZURlZmF1bHRDZXJ0ID0gdHJ1ZSxcbiAgfSA9IG9wdHM7XG4gIHRyeSB7XG4gICAgYXdhaXQgZ2V0QXBrc2lnbmVyRm9yT3ModGhpcyk7XG4gICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgdGhpcy5leGVjdXRlQXBrc2lnbmVyKFsndmVyaWZ5JywgJy0tcHJpbnQtY2VydHMnLCBhcHBQYXRoXSk7XG4gICAgY29uc3QgaGFzTWF0Y2ggPSBoYXNoTWF0Y2hlcyhvdXRwdXQpO1xuICAgIGlmIChoYXNNYXRjaCkge1xuICAgICAgbG9nLmluZm8oYCcke2FwcFBhdGh9JyBpcyBzaWduZWQgd2l0aCB0aGUgYCArXG4gICAgICAgIGAke3RoaXMudXNlS2V5c3RvcmUgPyAna2V5c3RvcmUnIDogJ2RlZmF1bHQnfSBjZXJ0aWZpY2F0ZWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuaW5mbyhgJyR7YXBwUGF0aH0nIGlzIHNpZ25lZCB3aXRoIGEgYCArXG4gICAgICAgIGBub24tJHt0aGlzLnVzZUtleXN0b3JlID8gJ2tleXN0b3JlJyA6ICdkZWZhdWx0J30gY2VydGlmaWNhdGVgKTtcbiAgICB9XG4gICAgcmV0dXJuICghdGhpcy51c2VLZXlzdG9yZSAmJiAhcmVxdWlyZURlZmF1bHRDZXJ0KSB8fCBoYXNNYXRjaDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgbm8gc2lnbmF0dXJlXG4gICAgaWYgKF8uaW5jbHVkZXMoZXJyLnN0ZGVyciwgQVBLU0lHTkVSX1ZFUklGWV9GQUlMKSkge1xuICAgICAgbG9nLmluZm8oYCcke2FwcFBhdGh9JyBpcyBub3Qgc2lnbmVkYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHZlcmlmeSB0aGUgc2lnbmF0dXJlIG9mICcke2FwcFBhdGh9Jy4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLnN0ZGVyciB8fCBlcnIuc3Rkb3V0IHx8IGVyci5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEtleXN0b3JlSGFzaFxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBtZDUgdGhlIG1kNSBoYXNoIHZhbHVlIG9mIHRoZSBrZXlzdG9yZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBzaGExIHRoZSBzaGExIGhhc2ggdmFsdWUgb2YgdGhlIGtleXN0b3JlXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHNoYTI1NiB0aGUgc2hhMjU2IGhhc2ggdmFsdWUgb2YgdGhlIGtleXN0b3JlXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHNoYTUxMiB0aGUgc2hhNTEyIGhhc2ggdmFsdWUgb2YgdGhlIGtleXN0b3JlXG4gKi9cblxuLyoqXG4gKiBSZXRyaWV2ZSB0aGUgdGhlIGhhc2ggb2YgdGhlIGdpdmVuIGtleXN0b3JlLlxuICpcbiAqIEByZXR1cm4ge0tleXN0b3JlSGFzaH1cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBnZXR0aW5nIGtleXN0b3JlIGhhc2ggZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLmdldEtleXN0b3JlSGFzaCA9IGFzeW5jIGZ1bmN0aW9uIGdldEtleXN0b3JlSGFzaCAoKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBoYXNoIG9mIHRoZSAnJHt0aGlzLmtleXN0b3JlUGF0aH0nIGtleXN0b3JlYCk7XG4gIGNvbnN0IGtleXRvb2wgPSBwYXRoLnJlc29sdmUoYXdhaXQgZ2V0SmF2YUhvbWUoKSwgJ2JpbicsXG4gICAgYGtleXRvb2wke3N5c3RlbS5pc1dpbmRvd3MoKSA/ICcuZXhlJyA6ICcnfWApO1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhrZXl0b29sKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGtleXRvb2wgdXRpbGl0eSBjYW5ub3QgYmUgZm91bmQgYXQgJyR7a2V5dG9vbH0nYCk7XG4gIH1cbiAgY29uc3QgYXJncyA9IFtcbiAgICAnLXYnLCAnLWxpc3QnLFxuICAgICctYWxpYXMnLCB0aGlzLmtleUFsaWFzLFxuICAgICcta2V5c3RvcmUnLCB0aGlzLmtleXN0b3JlUGF0aCxcbiAgICAnLXN0b3JlcGFzcycsIHRoaXMua2V5c3RvcmVQYXNzd29yZFxuICBdO1xuICBsb2cuaW5mbyhgUnVubmluZyAnJHtrZXl0b29sfScgd2l0aCBhcmd1bWVudHM6ICR7dXRpbC5xdW90ZShhcmdzKX1gKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoa2V5dG9vbCwgYXJncyk7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBoYXNoTmFtZSBvZiBbU0hBNTEyLCBTSEEyNTYsIFNIQTEsIE1ENV0pIHtcbiAgICAgIGNvbnN0IGhhc2hSZSA9IG5ldyBSZWdFeHAoYF5cXFxccyoke2hhc2hOYW1lfTpcXFxccyooW2EtZjAtOTpdKylgLCAnbWknKTtcbiAgICAgIGNvbnN0IG1hdGNoID0gaGFzaFJlLmV4ZWMoc3Rkb3V0KTtcbiAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICByZXN1bHRbaGFzaE5hbWVdID0gbWF0Y2hbMV0ucmVwbGFjZSgvOi9nLCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShyZXN1bHQpKSB7XG4gICAgICBsb2cuZGVidWcoc3Rkb3V0KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHBhcnNlIHRoZSBoYXNoIHZhbHVlIGZyb20gdGhlIGtleXRvb2wgb3V0cHV0Jyk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgS2V5c3RvcmUgaGFzaDogJHtKU09OLnN0cmluZ2lmeShyZXN1bHQpfWApO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBnZXQgdGhlIGhhc2ggb2YgJyR7dGhpcy5rZXlzdG9yZVBhdGh9JyBrZXlzdG9yZS4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhcGtTaWduaW5nTWV0aG9kcztcbiJdLCJmaWxlIjoibGliL3Rvb2xzL2Fway1zaWduaW5nLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
